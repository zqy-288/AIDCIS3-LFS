# 扇形显示优化总结

## 问题现象
加载DXF文件后选择扇形时出现：
1. 先显示一个很大的扇形图
2. 然后突然自适应到正常大小
3. 视觉上有明显的跳动和闪烁

## 问题原因分析

### 原始逻辑流程
```
加载DXF → 全部孔位加载到场景 → 选择扇形 → 清空场景 → 重新加载扇形孔位 → fitInView自适应
```

这个流程导致：
- **场景重建**：清空再加载会导致闪烁
- **多次fitInView**：自动适配机制被触发多次
- **坐标系变化**：从完整管板坐标系突变到扇形坐标系

### 根本原因
使用了"清空-重新加载"模式而不是"显示-隐藏"模式。

## 优化方案

### 1. 改用场景过滤模式
```python
# 不再清空场景重新加载，而是显示/隐藏已有的项
def _filter_scene_items(self, filtered_collection):
    for item in scene.items():
        if hole_id in filtered_ids:
            item.setVisible(True)  # 显示扇形内的孔
        else:
            item.setVisible(False)  # 隐藏其他孔
```

### 2. 智能视图调整
- 收集可见项的边界
- 计算合适的视图区域
- 一次性调整到位，避免多次fitInView

### 3. 优化加载顺序
- 优先使用场景过滤（无闪烁）
- 只在必要时才重新加载（备选方案）

## 实现改进

### 修改的文件
`/src/pages/main_detection_p1/components/panorama_sector_coordinator.py`

### 关键改进点
1. `_update_center_view` 方法优先使用场景过滤
2. `_filter_scene_items` 方法增加了边界计算和一次性视图调整
3. 避免了不必要的场景清空和重建

## 效果
- **无闪烁**：使用显示/隐藏而不是清空/加载
- **平滑过渡**：视图调整一次到位
- **性能提升**：避免重复创建图形项

## 进一步优化建议
1. **预加载优化**：可以在初始加载时就按扇形组织场景项
2. **动画过渡**：使用QPropertyAnimation实现平滑的视图过渡
3. **延迟加载**：只在需要时才创建扇形外的孔位图形项