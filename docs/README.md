# 上位机软件 - 管孔检测系统

基于test.md文档开发的最小可开发单元实现，专注于实时监控功能的MVP版本。

## 项目概述

本项目是一个工业级管孔检测系统的上位机软件，主要功能包括：
- 实时监控光谱共焦传感器测量数据
- 显示管孔直径随深度变化的实时图表
- 公差上下限标示和状态监控
- 多线程架构确保UI流畅性

## 技术架构

### 核心技术栈
- **GUI框架**: PySide6 (Qt官方Python绑定)
- **实时图表**: pyqtgraph (高性能实时绘图)
- **数据处理**: numpy (数值计算)
- **多线程**: QThread (线程安全的数据传递)

### 架构设计
```
[硬件数据源] -> [WorkerThread] --(Signal)--> [MainWindow] -> [pyqtgraph更新]
```

## 项目结构

```
上位机软件/
├── main.py                 # 程序入口
├── main_window.py          # 主窗口
├── realtime_chart.py       # 实时图表组件
├── worker_thread.py        # 数据工作线程
├── requirements.txt        # 依赖列表
├── README.md              # 项目说明
└── 最小可开发单元方案.md   # 开发方案文档
```

## 快速开始

### 1. 环境要求
- Python 3.8+
- Windows/Linux/macOS

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

### 3. 运行程序
```bash
python main.py
```

## 功能说明

### 当前实现的功能 (MVP版本)

#### 实时监控视图
- ✅ 实时折线图显示管孔直径数据
- ✅ 公差上下限水平线标示
- ✅ 状态信息显示（孔ID、探头深度、通信状态）
- ✅ 多线程数据处理，确保UI流畅
- ✅ 数据缓冲和动态X轴范围调整
- ✅ 开始/停止/清除控制功能

#### 主窗口界面
- ✅ 选项卡式界面设计
- ✅ 菜单栏和状态栏
- ✅ 设备连接状态指示
- ✅ 优雅的程序退出处理

### 预留功能 (后续版本)

#### 历史数据查看器
- 🔄 光谱共焦历史数据查询
- 🔄 拟合圆图显示
- 🔄 工件ID和孔ID搜索
- 🔄 数据导出功能

#### 主检测视图
- 🔄 工件示意图显示
- 🔄 检测点状态颜色编码
- 🔄 流程主控制按钮
- 🔄 页面导航功能

#### 缺陷标注工具
- 🔄 内窥镜图像审查
- 🔄 缺陷标注工具
- 🔄 COCO格式数据导出

## 使用说明

### 启动测量
1. 运行程序后，主窗口会显示
2. 点击"实时监控"选项卡
3. 点击"开始测量"按钮
4. 观察实时数据图表更新

### 数据模拟
当前版本使用模拟数据源，包含：
- 正常测量数据（带噪声）
- 深度相关的直径变化
- 可配置的公差范围
- 通信状态模拟

### 图表功能
- **缩放**: 鼠标滚轮缩放
- **平移**: 鼠标拖拽平移
- **自动范围**: 动态调整显示范围
- **公差线**: 红色虚线显示上下限
- **目标线**: 绿色点线显示目标值

## 开发说明

### 代码结构

#### worker_thread.py
- `WorkerThread`: 数据采集线程类
- `DataSimulator`: 数据模拟器
- 信号定义：`data_updated`, `status_updated`

#### realtime_chart.py
- `RealtimeChart`: 实时图表组件
- 数据缓冲管理
- 图表样式和公差线设置
- 槽函数：`update_data`, `update_status`

#### main_window.py
- `MainWindow`: 主窗口类
- 选项卡管理
- 菜单和状态栏
- 线程生命周期管理

### 扩展开发

#### 添加新功能模块
1. 在主窗口添加新的选项卡
2. 创建对应的组件类
3. 实现必要的信号槽连接

#### 集成真实硬件
1. 修改`WorkerThread`中的数据获取逻辑
2. 替换模拟数据为真实硬件接口
3. 调整数据格式和处理流程

## 测试

### 运行测试
```bash
# 测试数据工作线程
python worker_thread.py

# 测试实时图表组件
python realtime_chart.py

# 测试主窗口
python main_window.py
```

### 性能测试
- 数据频率：50Hz (可调整)
- 最大显示点数：2000点
- 内存使用：动态缓冲管理
- UI响应性：多线程架构保证

## 故障排除

### 常见问题

1. **依赖安装失败**
   ```bash
   pip install --upgrade pip
   pip install -r requirements.txt
   ```

2. **图表显示异常**
   - 检查pyqtgraph版本兼容性
   - 确认显卡驱动支持OpenGL

3. **线程通信问题**
   - 确保信号槽连接正确
   - 检查线程生命周期管理

## 版本历史

### v1.0.0 (当前版本)
- ✅ 实现基础实时监控功能
- ✅ 多线程架构
- ✅ 模拟数据源
- ✅ 基础UI框架

### 计划版本
- v1.1.0: 历史数据查看功能
- v1.2.0: 主检测视图
- v1.3.0: 缺陷标注工具
- v2.0.0: 完整功能集成

## 贡献指南

1. Fork项目
2. 创建功能分支
3. 提交更改
4. 创建Pull Request

## 许可证

本项目采用MIT许可证。

## 联系方式

- 负责人：卿扬
- 项目文档：基于test.md开发方案
