# 核心工作流

本文件描述了用户在使用“管孔检测系统”时遵循的核心工作流。

## 工作流 1: 执行新的检测任务

此工作流描述了用户从启动应用程序到完成一个孔的检测的整个过程。

1.  **启动应用程序**:
    - 用户运行 `main.py` 启动应用程序。
    - `main.py` 初始化应用程序、数据库并显示主窗口 (`MainWindow`)。

2.  **选择要检测的孔**:
    - 应用程序默认显示“主检测视图” (`main_detection_view.py`)。
    - 此视图显示了当前工件上所有孔的布局图。
    - 用户在图上点击一个特定的孔（例如 `H001`）。

3.  **导航到实时监控**:
    - 点击孔后，`main_detection_view` 发出 `navigate_to_realtime` 信号。
    - `main_window` 捕获此信号，并切换到“实时监控”选项卡 (`realtime_chart.py`)。
    - 所选的孔 ID (例如 `H001`) 被传递到 `realtime_tab`。

4.  **开始测量**:
    - 在“实时监控”选项卡中，用户点击“开始测量”按钮。
    - 在当前版本中，这将触发 CSV 文件导入功能，模拟实时数据采集。
    - 数据被读取、处理，并在图表上实时显示。

5.  **停止测量**:
    - 数据采集完成后，用户点击“停止测量”按钮。
    - 测量过程结束，数据被保存到数据库中。

## 工作流 2: 查看历史数据

此工作流描述了用户如何查看已完成检测的孔的历史数据。

1.  **导航到历史数据视图**:
    - 用户可以在主窗口中直接点击“历史数据”选项卡 (`history_viewer.py`)。
    - 或者，在“主检测视图”中，可能有相应的操作（例如右键菜单）将用户导航到特定孔的历史数据。

2.  **加载和显示数据**:
    - 在“历史数据”视图中，用户选择一个工件和一个孔 ID。
    - `history_viewer` 从数据库中检索与该孔相关的所有 `Measurement` 记录。
    - 检索到的数据显示在图表和表格中，以供分析。

## 工作流 3: 进行缺陷标注

此工作流描述了用户如何为内窥镜图像添加缺陷标注。

1.  **导航到缺陷标注工具**:
    - 用户点击主窗口中的“缺陷标注”选项卡 (`annotation_tool.py`)。

2.  **加载图像**:
    - 用户在标注工具中加载一个或多个内窥镜图像。
    - 这些图像可以是从数据库加载的，也可以是从本地文件系统导入的。

3.  **进行标注**:
    - 用户使用工具栏中的绘图工具（例如矩形、多边形）在图像上圈出缺陷区域。
    - 对于每个标注，用户可以指定缺陷类型（例如“裂纹”、“腐蚀”）并添加注释。

4.  **保存标注**:
    - 完成标注后，用户保存更改。
    - 标注数据（坐标、缺陷类型等）被保存到数据库的 `annotations` 表中。
