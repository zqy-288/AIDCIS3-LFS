# 上位机软件最小可开发单元方案

基于test.md文档分析，将上位机软件分解为以下最小可开发单元，按优先级排序：

## 开发优先级与依赖关系

### 第一阶段：核心基础模块 (MVP)
**目标：建立可运行的基础框架，实现最核心的实时监控功能**

#### 单元1：环境搭建与依赖安装 (0.5天)
- **输入：** 开发环境要求
- **输出：** 完整的Python开发环境
- **验收标准：** 所有依赖包成功安装，能够导入核心库
```bash
pip install PySide6 pyqtgraph numpy
```

#### 单元2：数据工作线程实现 (1天)
- **输入：** 硬件数据接口规范
- **输出：** WorkerThread类，支持数据模拟和信号发射
- **核心文件：** `worker_thread.py`
- **验收标准：** 
  - 能够模拟生成测量数据
  - 正确发射PySide6信号
  - 线程安全运行

#### 单元3：主窗口UI构建 (1天)
- **输入：** UI设计规范
- **输出：** 基础主窗口，集成pyqtgraph图表
- **核心文件：** `main_window.py`
- **验收标准：**
  - 窗口正常显示
  - pyqtgraph图表正确嵌入
  - 基础布局完整

#### 单元4：实时图表更新机制 (1.5天)
- **输入：** 数据工作线程的信号
- **输出：** 完整的实时监控界面
- **核心文件：** `realtime_chart.py`
- **验收标准：**
  - 实时数据流畅显示
  - 公差上下限正确标示
  - 多线程数据传递稳定

### 第二阶段：历史数据查看功能 (扩展功能)

#### 单元5：数据库模型定义 (0.5天)
- **输入：** 数据库设计规范
- **输出：** SQLAlchemy ORM模型
- **核心文件：** `models.py`
- **验收标准：** 数据模型正确定义，数据库连接成功

#### 单元6：历史数据查询界面 (1天)
- **输入：** 查询需求规范
- **输出：** 带搜索功能的用户界面
- **核心文件：** `history_viewer.py`
- **验收标准：** 
  - 输入框和按钮正常工作
  - 查询逻辑正确实现

#### 单元7：数据可视化与科学计算 (1.5天)
- **输入：** 历史数据
- **输出：** 静态图表和拟合圆显示
- **核心文件：** `data_visualization.py`
- **验收标准：**
  - Matplotlib图表正确显示
  - 圆形拟合算法准确
  - 数据处理性能良好

### 第三阶段：UI预留与集成 (完善阶段)

#### 单元8：一级页面UI预留 (0.5天)
- **输入：** 主检测视图设计
- **输出：** 布局框架和导航接口
- **核心文件：** `main_detection_view.py`
- **验收标准：** UI布局预留完整，接口定义清晰

#### 单元9：内窥镜标注页面UI预留 (0.5天)
- **输入：** 标注功能设计
- **输出：** 标注界面布局框架
- **核心文件：** `annotation_view.py`
- **验收标准：** 为后续标注功能预留完整空间

## 技术架构设计

### 核心技术栈
- **GUI框架：** PySide6 (Qt官方Python绑定)
- **实时图表：** pyqtgraph (高性能实时绘图)
- **数据处理：** numpy (数值计算)
- **数据库：** SQLAlchemy (ORM)
- **静态图表：** Matplotlib (历史数据展示)
- **科学计算：** SciPy (圆形拟合)

### 多线程架构
```
[硬件数据源] -> [WorkerThread] --(Signal)--> [MainWindow] -> [pyqtgraph更新]
```

### 项目结构
```
上位机软件/
├── main.py                 # 程序入口
├── worker_thread.py        # 数据工作线程
├── main_window.py          # 主窗口
├── realtime_chart.py       # 实时图表组件
├── models.py               # 数据库模型
├── history_viewer.py       # 历史数据查看器
├── data_visualization.py   # 数据可视化
├── main_detection_view.py  # 主检测视图(预留)
├── annotation_view.py      # 标注视图(预留)
└── requirements.txt        # 依赖列表
```

## 开发里程碑

### 里程碑1：MVP版本 (4天)
- 完成单元1-4
- 实现基础实时监控功能
- 可演示核心价值

### 里程碑2：完整版本 (7天)
- 完成单元1-7
- 实现历史数据查看功能
- 具备完整的数据处理能力

### 里程碑3：框架完整版 (8天)
- 完成所有单元
- UI框架完整
- 为后续功能扩展做好准备

## 测试策略

### 单元测试
- 每个开发单元都应包含独立的测试用例
- 重点测试多线程安全性和数据处理准确性

### 集成测试
- 测试各模块间的数据流转
- 验证UI响应性能

### 性能测试
- 实时数据处理性能测试
- 大数据量历史查询性能测试

## 风险控制

### 技术风险
- **多线程同步：** 使用PySide6信号槽机制确保线程安全
- **实时性能：** pyqtgraph专为高频数据设计，性能有保障
- **数据库性能：** SQLAlchemy提供连接池和查询优化

### 开发风险
- **依赖管理：** 使用requirements.txt固化版本
- **模块解耦：** 每个单元独立开发，降低相互影响
- **渐进交付：** 按里程碑分阶段交付，及时获得反馈

这个方案确保了每个开发单元都是独立的、可测试的，并且按照业务价值优先级排序，能够快速交付可用的MVP版本。
