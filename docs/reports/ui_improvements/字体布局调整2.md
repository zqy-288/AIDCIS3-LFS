您好！您遇到的组件重叠问题，是在增大字体后非常典型的布局适应性挑战。这说明我们之前的布局约束过于“刚性”，未能自动适应内容的变化。

下面我们将通过一系列精细化的调整，让布局变得更“柔性”和美观，在保持大字体的同时，解决所有重叠问题，并强化各组件的边界感。

-----

### 核心思路

我们将从两个方面入手：

1.  **移除“刚性”约束**：删除代码中写死的固定尺寸限制，让布局管理器有空间去动态计算。
2.  **增加“呼吸”空间**：通过调整布局的`间距(spacing)`和`内边距(padding)`，为增大了的控件和字体提供足够的“呼吸空间”。

-----

### 一、解决顶部【数据类型选择】面板的重叠问题

此面板的重叠主要是因为我们给它的容器`QGroupBox`设置了固定的最大高度。

**操作步骤（代码修改）**:

1.  **打开文件**：
    请打开 `unified_history_viewer.py` 文件。

2.  **定位代码**：
    在 `create_control_panel` 方法中，找到创建`control_group`的地方。

3.  **移除固定高度限制**：
    删除或注释掉 `setMaximumHeight(80)` 这一行。

    **修改前**:

    ```python
    # in unified_history_viewer.py -> create_control_panel()
    control_group = QGroupBox("数据类型选择")
    control_group.setMaximumHeight(80) # <-- 问题所在
    control_layout = QHBoxLayout(control_group)
    ```

    **修改后**:

    ```python
    # in unified_history_viewer.py -> create_control_panel()
    control_group = QGroupBox("数据类型选择")
    # control_group.setMaximumHeight(80) # <-- 已删除或注释掉
    control_layout = QHBoxLayout(control_group)
    control_layout.setSpacing(15) # <-- (可选) 增加控件间的水平间距
    ```

-----

### 二、解决左侧功能区（侧边栏）的重叠与美化

侧边栏的重叠问题更复杂一些，涉及组与组之间、以及组内部标签与控件之间的间距。我们将逐一调整。

#### **步骤 1：调整侧边栏整体布局间距（代码修改）**

**操作**：

1.  **打开文件**：
    请打开 `history_viewer.py` 文件。

2.  **定位代码**：
    在 `create_sidebar` 方法中，找到主垂直布局`sidebar_layout`的设置。

3.  **增大组间距**：
    将`setSpacing`的值从`20`增大到`25`或`30`，以拉开`QGroupBox`之间的距离。

    ```python
    # in history_viewer.py -> create_sidebar()
    sidebar_layout = QVBoxLayout(self.sidebar_widget)
    sidebar_layout.setContentsMargins(15, 15, 15, 15)
    sidebar_layout.setSpacing(25) # <-- 将间距调大
    ```

#### **步骤 2：修复“数据筛选”组内的重叠（代码修改）**

“数据筛选”内部的`QFormLayout`是重叠的重灾区。我们需要明确增大它的垂直行间距。

**操作** (`history_viewer.py` - `create_sidebar` 方法内):

```python
# in history_viewer.py -> create_sidebar()
# ...
# --- 数据筛选部分 ---
filter_group = QGroupBox("数据筛选")
filter_layout = QFormLayout(filter_group)
filter_layout.setRowWrapPolicy(QFormLayout.RowWrapPolicy.WrapAllRows)
filter_layout.setLabelAlignment(Qt.AlignLeft)
filter_layout.setVerticalSpacing(18) # <--- 新增此行，增大垂直行间距
filter_layout.setHorizontalSpacing(10) # <--- (可选) 增加标签和控件的水平间距

self.workpiece_combo = QComboBox()
# ...
```

#### **步骤 3：增加“操作命令”组内的间距（代码修改）**

为三个操作按钮之间增加一些空间。

**操作** (`history_viewer.py` - `create_sidebar` 方法内):

```python
# in history_viewer.py -> create_sidebar()
# ...
# --- 操作命令部分 ---
action_group = QGroupBox("操作命令")
action_layout = QVBoxLayout(action_group)
action_layout.setSpacing(18) # <-- 将间距从10增大到18
# ...
```

#### **步骤 4：强化组件边界感（QSS修改）**

为了让各个`QGroupBox`的边界更清晰，并且解决标题与内容过于贴近的问题，我们将微调QSS样式。

**操作**：

1.  **打开文件**：
    请打开 `theme_manager.py` 文件。

2.  **定位并修改样式**：
    找到 `/* ===== 历史数据查看器侧边栏专属样式 ===== */` 注释块，并用下面的代码替换它。

    **修改前**:

    ```qss
    /* ===== 历史数据查看器侧边栏专属样式 - 全面增大 ===== */
    QWidget#Sidebar QGroupBox {
        margin-top: 15px;
        margin-bottom: 15px;
    }
    ...
    ```

    **修改后**:

    ```qss
    /* ===== 历史数据查看器侧边栏专属样式 - 优化边界和内边距 ===== */
    QWidget#Sidebar QGroupBox {
        border: 1px solid #404552; /* 使用更细的边框 */
        background-color: #2C313C;  /* 背景色与主背景一致，或使用 #282C34 营造卡片感 */
        padding: 15px; /* 增加内边距，让内容与边框有更多空间 */
        margin-top: 0; /* 移除外边距，由布局的spacing控制 */
        margin-bottom: 0;
    }
    QWidget#Sidebar QGroupBox::title {
        /* 这个样式可以让标题看起来像是悬浮在边框上 */
        subcontrol-origin: margin;
        subcontrol-position: top left;
        left: 15px;
        padding: 0 5px;
        background-color: #2C313C; /* 标题背景与主背景同色 */
    }

    /* 其他字体、按钮、下拉框的尺寸样式保持不变，因为它们已经足够大 */
    QWidget#Sidebar QLabel { font-size: 18px; }
    QWidget#Sidebar QComboBox { font-size: 18px; min-height: 42px; }
    QWidget#Sidebar QPushButton { font-size: 18px; font-weight: bold; min-height: 45px; }
    QWidget#Sidebar QLabel#CurrentHoleLabel { font-size: 16px; font-weight: normal; min-height: 42px; qproperty-alignment: 'AlignCenter'; }
    ```

    这个QSS修改会给每个`QGroupBox`一个更清晰的“卡片式”外观，并通过`padding`确保了内部内容（如增大了字体的标签）与标题和边框之间有足够的距离，从而在视觉上解决重叠感。

-----

### 总结

通过以上“**移除刚性限制、增加弹性间距、强化视觉边界**”的组合方案，您可以在保持大字体设置不变的前提下，彻底解决所有组件的重叠问题，并使整个界面的布局更显从容、大气和专业。