# 【使用模拟进度】功能详细说明

## 🎯 功能概述

**【使用模拟进度】**是管孔检测系统中的一个**演示和测试功能**，用于模拟真实的孔位检测过程，帮助用户：
- 🔍 预览检测过程的视觉效果
- 📊 测试界面的状态更新和数据流
- 🎨 验证孔位颜色变化和状态显示
- 📈 观察检测进度的实时更新

## 🔄 具体操作流程

### 第一步：点击按钮前的准备
**前置条件**：
- ✅ 必须先加载DXF文件（产品型号或DXF文件）
- ✅ 界面中必须显示孔位图形
- ✅ 按钮从灰色禁用状态变为可点击

### 第二步：点击【使用模拟进度】
**按钮状态变化**：
```
点击前: [使用模拟进度] (灰色禁用)
点击后: [停止模拟] (绿色激活)
```

### 第三步：模拟过程启动
**系统自动执行**：
1. **📋 准备阶段**：
   - 收集所有孔位数据
   - 按孔位ID排序（C001R001, C001R002, ...）
   - 显示待处理孔位总数

2. **⏰ 启动定时器**：
   - 每1000ms (1秒) 处理一个孔位
   - 便于用户观察变化过程

3. **🎯 开始模拟检测**：
   - 在日志中显示："🚀 开始模拟进度 V2 - 扇形顺序模式"

## 📊 模拟过程中的具体变化

### 对每个孔位的处理步骤：

#### 步骤1：选中孔位
- 🔍 系统按顺序选择下一个孔位
- 📝 日志显示：`🔄 正在处理孔位: C001R001 (索引: 1/25210)`

#### 步骤2：设置检测中状态
- 🔵 孔位颜色变为**蓝色**（检测中）
- 📊 状态更新为：`PROCESSING`
- 🎨 日志显示颜色变化：`🎨 颜色变化: #原色 → #0000FF`

#### 步骤3：模拟检测结果
**随机生成检测结果**：
- 🟢 **99.5%概率**：合格 (`QUALIFIED`) - 绿色
- 🔴 **0.49%概率**：异常 (`DEFECTIVE`) - 红色  
- 🟡 **0.01%概率**：其他状态（盲孔/拉杆孔）- 黄色/蓝色

#### 步骤4：更新最终状态
- ⏱️ 短暂延迟后更新为最终状态
- 🎨 孔位颜色变为对应的最终颜色
- 📝 日志显示：`🟢 C001R001: 检测完成 → QUALIFIED`

## 🖥️ 界面实时更新内容

### 1. 左侧信息面板
**检测进度组**：
- 📊 总进度百分比更新
- 🔢 已检测/总数量更新
- ⏱️ 检测用时实时计时

**状态统计组**：
- 🟢 合格数量递增
- 🔴 异常数量递增
- 🟡 其他状态数量更新

**当前孔位信息**：
- 🎯 显示正在检测的孔位ID
- 📍 显示孔位坐标位置
- 📊 显示检测状态变化

### 2. 中间图形显示区
**扇形视图**：
- 🔄 按扇形顺序逐个显示区域
- 🎯 当前扇形的孔位依次变色
- 📍 检测中的孔位会高亮显示

**全景预览**：
- 🗺️ 小地图同步显示检测进度
- 🎨 孔位颜色实时更新
- 📍 当前检测位置标记

### 3. 右侧操作面板
**检测控制**：
- 📊 批次进度显示
- ⏱️ 检测时间显示
- 🔄 按钮状态：[停止模拟]

## 🔧 技术实现细节

### 核心定时器机制
```python
# 主要定时器：每1秒处理一个孔位
self.simulation_timer.start(1000)

# 状态更新定时器：每秒更新界面
self.update_timer.start(1000)

# 检测时间定时器：每秒更新计时
self.detection_time_timer.start(1000)
```

### 状态变化流程
```python
# 1. 设置检测中状态
current_hole.status = HoleStatus.PROCESSING
hole_item.update_status(current_hole.status)

# 2. 生成随机结果
rand_value = random.random()
if rand_value < 0.995:
    final_status = HoleStatus.QUALIFIED  # 99.5%概率

# 3. 延迟更新最终状态
QTimer.singleShot(500, update_final_status)
```

## 🎮 用户操作说明

### 启动模拟
1. 确保已加载DXF文件
2. 点击【使用模拟进度】按钮
3. 观察孔位依次变色
4. 查看左侧统计信息更新

### 停止模拟
1. 再次点击按钮（此时显示【停止模拟】）
2. 模拟立即停止
3. 按钮恢复为【使用模拟进度】
4. 所有定时器停止

### 观察要点
- 🎯 **孔位变色顺序**：按ID排序依次处理
- 📊 **统计数据变化**：左侧数字实时更新  
- 🗺️ **全景图同步**：小地图显示整体进度
- ⏱️ **时间计数**：检测用时持续增加

## 💡 使用场景

### 1. 系统演示
- 向客户展示检测过程
- 演示界面功能和视觉效果
- 展示数据统计和报告功能

### 2. 功能测试
- 测试界面响应性能
- 验证数据更新逻辑
- 检查状态同步机制

### 3. 培训教学
- 培训操作人员界面使用
- 展示检测流程和结果解读
- 演示异常情况处理

### 4. 开发调试
- 测试图形渲染性能
- 验证数据结构正确性
- 调试状态管理逻辑

## ⚠️ 注意事项

### 模拟与真实检测的区别
- ✅ **模拟**：随机生成结果，用于演示
- 🔧 **真实检测**：连接硬件设备，实际检测

### 性能考虑
- 🕐 每秒处理一个孔位，便于观察
- 📊 25,000个孔位需要约7小时完成
- ⏹️ 可随时停止，不影响数据

### 数据安全
- 🔒 模拟过程不影响原始数据
- 💾 模拟结果不会保存到文件
- 🔄 重新加载DXF会重置状态

---

**总结**：【使用模拟进度】是一个强大的演示和测试工具，通过可视化的方式展示整个检测过程，帮助用户理解系统功能和检测流程。