# 统一定时器解决方案

## 问题根源
之前使用两个独立的定时器导致时序同步困难：
- `simulation_timer`：每10秒触发一次
- `status_change_timer`：单次9.5秒触发

两个定时器之间的协调容易出现时序偏差。

## 新方案：单一主定时器
使用一个100ms精度的主定时器控制整个流程，通过状态机管理不同阶段。

### 核心机制
```python
master_timer (100ms) → _master_tick() → 状态机控制
                                        ├─ IDLE: 准备开始新周期
                                        ├─ DETECTING: 检测中（0-9.5秒）
                                        └─ FINALIZING: 完成中（9.5-10秒）
```

### 时序保证
```
时间线：
0ms     : IDLE → DETECTING, 开始检测（蓝色）
9500ms  : DETECTING → FINALIZING, 变为最终颜色
10000ms : FINALIZING → IDLE, 准备下一个周期
```

### 关键代码
1. **主循环** (`_master_tick`)：
   - 每100ms执行一次
   - 根据当前状态和经过时间决定动作
   - 精确控制状态转换时机

2. **状态转换**：
   - `IDLE`：等待开始新周期
   - `DETECTING`：0-9500ms，显示蓝色
   - `FINALIZING`：9500-10000ms，显示最终颜色

3. **时间控制**：
   - `elapsed_in_cycle`：周期内经过时间（0-10000ms）
   - `status_change_time`：9500ms
   - `pair_detection_time`：10000ms

## 优势
1. **精确同步**：单一时间源，无需协调多个定时器
2. **状态清晰**：通过状态机明确每个阶段
3. **易于调试**：所有时序逻辑集中在一处
4. **灵活控制**：可以轻松调整各阶段时长

## 效果
- 严格的10秒检测间隔
- 精确的9.5秒颜色变化
- 不会出现时序偏差或重复触发