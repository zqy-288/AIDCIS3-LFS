# AIDCIS2 组件整合系统测试计划

**项目**: AIDCIS2组件整合后的端到端系统测试  
**目标**: 从最终用户角度验证整合后应用程序的完整功能和稳定性  
**创建时间**: 2025-07-07  

## 测试概述

本文档设计端到端的系统测试用例，覆盖核心用户工作流，验证整合后的应用程序作为一个整体能够稳定运行并满足用户需求。

## 测试环境配置

### 系统测试环境
- **操作系统**: Windows 10/11, macOS 12+, Ubuntu 20.04+
- **Python版本**: 3.8+
- **硬件要求**: 8GB RAM, 2GB可用磁盘空间
- **测试数据**: 真实规模的DXF文件和测量数据
- **网络环境**: 模拟生产网络条件

### 测试工具
- **自动化框架**: pytest + pytest-qt
- **UI自动化**: QTest + 自定义UI操作库
- **性能监控**: psutil + 自定义性能收集器
- **报告生成**: allure-pytest
- **截图工具**: 自动截图验证

## 第一类：应用程序生命周期测试

### ST-001: 应用启动和初始化测试
**测试目标**: 验证应用程序正确启动和初始化
**用户场景**: 用户首次启动应用程序

```python
class TestApplicationLifecycle:
    def test_application_startup(self):
        """测试应用程序启动"""
        # 步骤1: 启动应用程序
        # 验证: 主窗口正确显示
        # 验证: 所有选项卡正确加载
        # 验证: AIDCIS2界面正确初始化
        # 验证: 状态栏显示"就绪"状态
        # 验证: 启动时间 < 5秒
        
    def test_dependency_loading(self):
        """测试依赖项加载"""
        # 步骤1: 检查所有必需依赖
        # 验证: PySide6正确加载
        # 验证: ezdxf正确加载
        # 验证: numpy版本兼容
        # 验证: 无依赖冲突警告
        
    def test_database_initialization(self):
        """测试数据库初始化"""
        # 步骤1: 首次启动应用
        # 验证: 数据库文件正确创建
        # 验证: 表结构正确建立
        # 验证: 示例数据正确插入
        # 验证: 数据库连接正常
```

### ST-002: 应用程序关闭测试
**测试目标**: 验证应用程序正确关闭和资源清理
**用户场景**: 用户正常退出应用程序

```python
def test_normal_shutdown(self):
    """测试正常关闭"""
    # 步骤1: 执行一些操作
    # 步骤2: 点击关闭按钮
    # 验证: 确认对话框正确显示
    # 验证: 数据正确保存
    # 验证: 资源正确释放
    # 验证: 进程完全退出
    
def test_forced_shutdown(self):
    """测试强制关闭"""
    # 步骤1: 模拟系统强制关闭
    # 验证: 应用程序优雅退出
    # 验证: 临时文件正确清理
    # 验证: 无数据损坏
```

## 第二类：核心工作流测试

### ST-003: DXF文件加载和显示工作流
**测试目标**: 验证完整的DXF文件处理工作流
**用户场景**: 用户加载DXF文件并查看孔位信息

```python
class TestDXFWorkflow:
    def test_load_small_dxf_file(self):
        """测试加载小型DXF文件"""
        # 步骤1: 启动应用程序
        # 步骤2: 点击"文件" -> "打开DXF文件"
        # 步骤3: 选择包含100个孔位的DXF文件
        # 步骤4: 点击"打开"
        # 验证: 文件加载进度正确显示
        # 验证: 所有孔位正确显示在AIDCIS2界面
        # 验证: 孔位坐标和属性正确
        # 验证: 状态栏显示加载完成信息
        # 验证: 加载时间 < 2秒
        
    def test_load_large_dxf_file(self):
        """测试加载大型DXF文件"""
        # 步骤1: 启动应用程序
        # 步骤2: 加载包含25000个孔位的DXF文件
        # 验证: 加载进度条正确显示
        # 验证: 界面保持响应
        # 验证: 内存使用合理 (<2GB)
        # 验证: 所有孔位正确渲染
        # 验证: 缩放和平移功能正常
        # 验证: 加载时间 < 30秒
        
    def test_invalid_dxf_file_handling(self):
        """测试无效DXF文件处理"""
        # 步骤1: 尝试加载损坏的DXF文件
        # 验证: 错误信息清晰明确
        # 验证: 应用程序保持稳定
        # 验证: 可以继续加载其他文件
```

### ST-004: 孔位检测工作流
**测试目标**: 验证从孔位选择到检测完成的完整流程
**用户场景**: 用户选择孔位进行检测并查看结果

```python
class TestDetectionWorkflow:
    def test_single_hole_detection_workflow(self):
        """测试单孔检测工作流"""
        # 步骤1: 加载DXF文件
        # 步骤2: 在AIDCIS2界面点击选择孔位H001
        # 步骤3: 验证孔位高亮显示
        # 步骤4: 点击孔位跳转到实时监控
        # 验证: 正确切换到实时监控选项卡
        # 验证: 孔位ID正确传递
        # 步骤5: 在实时监控中点击"开始测量"
        # 步骤6: 观察实时数据更新
        # 验证: 图表正确显示测量数据
        # 验证: 数据更新频率正常
        # 步骤7: 测量完成后返回主界面
        # 验证: 孔位状态正确更新
        # 验证: 统计信息正确更新
        
    def test_batch_detection_workflow(self):
        """测试批量检测工作流"""
        # 步骤1: 加载包含多个孔位的DXF文件
        # 步骤2: 在AIDCIS2界面选择多个孔位
        # 步骤3: 启动批量检测
        # 验证: 检测进度正确显示
        # 验证: 当前检测孔位正确高亮
        # 验证: 完成的孔位状态正确更新
        # 验证: 可以暂停和恢复检测
        # 验证: 检测完成后统计信息正确
```

### ST-005: 历史数据查看工作流
**测试目标**: 验证历史数据查询和显示功能
**用户场景**: 用户查看已完成检测的历史数据

```python
class TestHistoryWorkflow:
    def test_history_data_viewing(self):
        """测试历史数据查看"""
        # 前置条件: 已有检测数据
        # 步骤1: 在AIDCIS2界面点击已检测的孔位
        # 步骤2: 验证跳转到历史数据选项卡
        # 验证: 正确显示该孔位的历史数据
        # 验证: 数据图表正确渲染
        # 步骤3: 切换不同的数据视图
        # 验证: 表格视图正确显示
        # 验证: 图表视图正确显示
        # 步骤4: 导出数据
        # 验证: 导出功能正常工作
        # 验证: 导出文件格式正确
        
    def test_data_filtering_and_search(self):
        """测试数据过滤和搜索"""
        # 步骤1: 在历史数据界面
        # 步骤2: 使用时间范围过滤
        # 验证: 过滤结果正确
        # 步骤3: 使用孔位ID搜索
        # 验证: 搜索结果准确
        # 步骤4: 使用状态过滤
        # 验证: 只显示指定状态的数据
```

## 第三类：用户交互测试

### ST-006: 界面导航和操作测试
**测试目标**: 验证用户界面的导航和操作功能
**用户场景**: 用户在不同界面间导航和操作

```python
class TestUserInteraction:
    def test_tab_navigation(self):
        """测试选项卡导航"""
        # 步骤1: 依次点击所有选项卡
        # 验证: 每个选项卡正确显示
        # 验证: 选项卡状态正确保持
        # 验证: 数据在选项卡间正确传递
        
    def test_menu_operations(self):
        """测试菜单操作"""
        # 步骤1: 测试文件菜单所有功能
        # 步骤2: 测试工具菜单所有功能
        # 步骤3: 测试帮助菜单所有功能
        # 验证: 所有菜单项正确响应
        # 验证: 快捷键正确工作
        
    def test_search_functionality(self):
        """测试搜索功能"""
        # 步骤1: 在AIDCIS2界面使用搜索框
        # 步骤2: 输入孔位ID进行搜索
        # 验证: 搜索结果正确显示
        # 验证: 点击结果正确定位
        # 步骤3: 使用模糊搜索
        # 验证: 模糊匹配正确工作
        # 步骤4: 搜索不存在的内容
        # 验证: 正确显示无结果提示
```

### ST-007: 界面响应性和性能测试
**测试目标**: 验证界面在各种操作下的响应性
**用户场景**: 用户进行密集操作时界面保持流畅

```python
def test_ui_responsiveness(self):
    """测试界面响应性"""
    # 步骤1: 加载大型DXF文件
    # 步骤2: 快速缩放和平移
    # 验证: 界面保持流畅 (>30fps)
    # 步骤3: 快速切换选项卡
    # 验证: 切换响应时间 < 200ms
    # 步骤4: 同时进行多个操作
    # 验证: 界面不卡顿
    
def test_memory_usage_stability(self):
    """测试内存使用稳定性"""
    # 步骤1: 长时间运行应用程序
    # 步骤2: 重复加载和卸载DXF文件
    # 步骤3: 重复进行检测操作
    # 验证: 内存使用保持稳定
    # 验证: 无明显内存泄漏
    # 验证: 垃圾回收正常工作
```

## 第四类：数据完整性测试

### ST-008: 数据一致性测试
**测试目标**: 验证数据在整个系统中的一致性
**用户场景**: 用户在不同模块中查看同一数据

```python
class TestDataIntegrity:
    def test_cross_module_data_consistency(self):
        """测试跨模块数据一致性"""
        # 步骤1: 在AIDCIS2中加载孔位数据
        # 步骤2: 在实时监控中更新孔位状态
        # 步骤3: 返回AIDCIS2查看状态
        # 验证: 状态更新正确同步
        # 步骤4: 在历史数据中查看同一孔位
        # 验证: 数据完全一致
        
    def test_data_persistence(self):
        """测试数据持久化"""
        # 步骤1: 进行一系列操作
        # 步骤2: 关闭应用程序
        # 步骤3: 重新启动应用程序
        # 验证: 所有数据正确恢复
        # 验证: 状态信息正确保持
        # 验证: 配置设置正确恢复
```

### ST-009: 数据导入导出测试
**测试目标**: 验证数据导入导出功能的完整性
**用户场景**: 用户导入外部数据和导出检测结果

```python
def test_csv_data_import(self):
    """测试CSV数据导入"""
    # 步骤1: 在实时监控中点击导入CSV
    # 步骤2: 选择测试CSV文件
    # 步骤3: 确认导入
    # 验证: 数据正确解析和显示
    # 验证: 图表正确更新
    # 验证: 导入进度正确显示
    
def test_data_export_functionality(self):
    """测试数据导出功能"""
    # 步骤1: 完成一些检测操作
    # 步骤2: 在历史数据中选择导出
    # 步骤3: 选择导出格式和路径
    # 验证: 导出文件正确生成
    # 验证: 导出数据完整准确
    # 验证: 文件格式符合规范
```

## 第五类：错误处理和恢复测试

### ST-010: 异常情况处理测试
**测试目标**: 验证系统在异常情况下的稳定性
**用户场景**: 系统遇到各种异常情况时的处理

```python
class TestErrorHandling:
    def test_file_access_error_handling(self):
        """测试文件访问错误处理"""
        # 步骤1: 尝试加载被占用的文件
        # 验证: 错误信息清晰明确
        # 验证: 系统保持稳定
        # 步骤2: 尝试保存到只读目录
        # 验证: 正确提示权限错误
        # 验证: 提供替代解决方案
        
    def test_network_error_handling(self):
        """测试网络错误处理"""
        # 步骤1: 模拟网络连接中断
        # 验证: 系统正确检测网络状态
        # 验证: 提供离线模式功能
        # 步骤2: 网络恢复后
        # 验证: 自动重连功能正常
        
    def test_memory_pressure_handling(self):
        """测试内存压力处理"""
        # 步骤1: 模拟低内存环境
        # 验证: 系统正确检测内存不足
        # 验证: 自动释放非必要资源
        # 验证: 提供内存不足警告
```

### ST-011: 系统恢复测试
**测试目标**: 验证系统的恢复能力
**用户场景**: 系统从异常状态恢复正常

```python
def test_crash_recovery(self):
    """测试崩溃恢复"""
    # 步骤1: 模拟应用程序崩溃
    # 步骤2: 重新启动应用程序
    # 验证: 自动检测异常退出
    # 验证: 提供恢复选项
    # 验证: 数据正确恢复
    # 验证: 临时文件正确清理
    
def test_configuration_recovery(self):
    """测试配置恢复"""
    # 步骤1: 删除或损坏配置文件
    # 步骤2: 启动应用程序
    # 验证: 自动创建默认配置
    # 验证: 系统正常运行
    # 验证: 用户可以重新配置
```

## 测试执行策略

### 测试环境矩阵
| 操作系统 | Python版本 | 依赖版本 | 测试重点 |
|---------|-----------|---------|---------|
| Windows 10 | 3.8 | 最低版本 | 兼容性测试 |
| Windows 11 | 3.11 | 推荐版本 | 功能测试 |
| macOS 12 | 3.10 | 推荐版本 | 跨平台测试 |
| Ubuntu 20.04 | 3.9 | 推荐版本 | 性能测试 |

### 测试数据集
- **小型数据集**: 100个孔位，用于快速验证
- **中型数据集**: 5000个孔位，用于常规测试
- **大型数据集**: 25000个孔位，用于性能测试
- **异常数据集**: 包含各种边界情况的数据

### 性能基准
- **启动时间**: < 5秒
- **DXF加载时间**: < 30秒 (25000孔位)
- **界面响应时间**: < 200ms
- **内存使用**: < 2GB (大型数据集)
- **CPU使用**: < 50% (正常操作)

### 测试自动化
```python
class SystemTestSuite:
    """系统测试套件"""
    
    def setup_test_environment(self):
        """设置测试环境"""
        
    def execute_test_scenario(self, scenario):
        """执行测试场景"""
        
    def capture_test_evidence(self):
        """捕获测试证据"""
        
    def generate_test_report(self):
        """生成测试报告"""
```

## 测试完成标准

### 功能完整性标准
- [ ] 所有核心工作流100%通过
- [ ] 所有用户交互功能正常
- [ ] 数据一致性100%验证
- [ ] 异常处理覆盖率≥90%

### 性能标准
- [ ] 启动时间满足要求
- [ ] 界面响应性满足要求
- [ ] 内存使用在合理范围
- [ ] 无明显性能回归

### 稳定性标准
- [ ] 连续运行24小时无崩溃
- [ ] 内存泄漏测试通过
- [ ] 异常恢复测试通过
- [ ] 跨平台兼容性验证

### 用户体验标准
- [ ] 界面操作直观易用
- [ ] 错误信息清晰明确
- [ ] 帮助文档完整准确
- [ ] 用户反馈积极正面

**最终验收标准**: 所有系统测试用例通过，性能指标达标，用户验收测试满意度≥95%。
