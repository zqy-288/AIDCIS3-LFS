# Git 合并冲突详细报告

**合并分支**: `origin/main` → `wsy_2`  
**合并时间**: 2025-07-13  
**合并策略**: 三方合并 (three-way merge)

## 冲突概览

在 `origin/main` 合并到 `wsy_2` 的过程中，只有一个文件产生了冲突：

| 文件路径 | 冲突类型 | 冲突区域数量 | 主要差异 |
|---------|---------|-------------|----------|
| `src/modules/realtime_chart.py` | 内容冲突 | 4个区域 | 设计风格、架构方式、功能特性差异 |

---

# src/modules/realtime_chart.py 完整冲突分析

## 🔴 冲突区域1: 第164-197行 - 状态面板和UI初始化

### **wsy_2分支版本 (Material Design绿色主题)**
```python
# 第164-190行
        # 状态信息面板 - 优化样式
        status_group = QGroupBox("检测状态")
        status_group.setStyleSheet("""
            QGroupBox {
                font-weight: bold;
                font-size: 12px;
                border: 2px solid #cccccc;
                border-radius: 8px;
                margin-top: 8px;
                padding-top: 8px;
            }
            QGroupBox::title {
                subcontrol-origin: margin;
                left: 10px;
                padding: 0 5px 0 5px;
                color: #333333;
            }
        """)
        status_layout = QHBoxLayout(status_group)

        # 当前孔位显示 - 改为文本显示，增大字体
        self.current_hole_label = QLabel("当前孔位：未选择")
        self.current_hole_label.setStyleSheet("""
            QLabel {
                font-size: 14px;
                font-weight: bold;
                color: #2196F3;
                padding: 8px 12px;
                background-color: #f0f8ff;
                border: 2px solid #2196F3;
                border-radius: 6px;
            }
        """)

# 第188-197行 (接续)
=======

# 第192-197行
        layout.addWidget(splitter)

        # 保存分割器引用，用于后续调整
        self.main_splitter = splitter

        # 延迟设置分割器比例，确保窗口已完全初始化
>>>>>>> origin/main
```

### **main分支版本 (现代科技蓝主题 + ObjectName管理)**
```python
# 第164-197行
        # 状态信息面板 - 优化为仪表盘样式，集成控制按钮
        status_group = QGroupBox("状态监控与主控制区")
        status_group.setObjectName("StatusDashboard")
        status_layout = QHBoxLayout(status_group)

        # 左侧：核心状态信息
        status_info_layout = QHBoxLayout()
        status_info_layout.setSpacing(20)

        # 当前孔位显示 - 改为文本显示，增大字体
        self.current_hole_label = QLabel("当前孔位：未选择")
        self.current_hole_label.setObjectName("InfoLabel")
        self.current_hole_label.setMinimumWidth(140)

        # 通信状态显示 - 强化关键状态，准备添加图标
        self.comm_status_label = QLabel("通信状态: 等待连接")
        self.comm_status_label.setObjectName("CommStatusLabel")
        self.comm_status_label.setMinimumWidth(150)

        # 探头深度显示 - 添加数据状态
        self.depth_label = QLabel("📏 探头深度: -- mm")
        self.depth_label.setObjectName("StaticInfoLabel")
        self.depth_label.setMinimumWidth(160)

        # 最大/最小直径显示 - 增强状态可视化
        self.max_diameter_label = QLabel("📈 最大直径: -- mm")
        self.max_diameter_label.setObjectName("StaticInfoLabel")
        self.max_diameter_label.setMinimumWidth(150)

        self.min_diameter_label = QLabel("📉 最小直径: -- mm")
        self.min_diameter_label.setObjectName("StaticInfoLabel")
        self.min_diameter_label.setMinimumWidth(150)

        # 添加状态信息到布局
        status_info_layout.addWidget(self.current_hole_label)
        status_info_layout.addWidget(self.comm_status_label)
        status_info_layout.addWidget(self.depth_label)
        status_info_layout.addWidget(self.max_diameter_label)
        status_info_layout.addWidget(self.min_diameter_label)

        status_layout.addLayout(status_info_layout)

        # 右侧：主控制按钮（移至状态栏内，集成设计）
        control_layout = QHBoxLayout()
        control_layout.setSpacing(15)

        self.start_button = QPushButton("▶️ 开始测量")
        self.start_button.setObjectName("StartButton")
        self.stop_button = QPushButton("⏹️ 停止测量")
        self.stop_button.setObjectName("StopButton")
        self.clear_button = QPushButton("🗑️ 清除数据")
        self.clear_button.setObjectName("ClearDataButton")

        control_layout.addWidget(self.start_button)
        control_layout.addWidget(self.stop_button)
        control_layout.addWidget(self.clear_button)

        status_layout.addLayout(control_layout)

        layout.addWidget(status_group)
```

## 🔴 冲突区域2: 第203-259行 - 面板布局和图表设置

### **wsy_2分支版本**
```python
# 第203-227行
        # 双面板区域 - 改为垂直布局（A在上，B在下）
        splitter = QSplitter(Qt.Vertical)

        # 面板A: 管孔直径数据 - 无边框设计，最大化内容区域
        panel_a = QGroupBox("光谱共焦传感器孔径监测数据")
        panel_a.setStyleSheet("""
            QGroupBox {
                font-weight: bold;
                font-size: 16px;
                border: 3px solid #4CAF50;
                border-radius: 12px;
                margin-top: 15px;
                padding-top: 15px;
                background-color: #f8fff8;
            }
            QGroupBox::title {
                subcontrol-origin: margin;
                left: 20px;
                padding: 5px 15px 5px 15px;
                color: #2E7D32;
                background-color: white;
                font-size: 16px;
                font-weight: bold;
                border: 2px solid #4CAF50;
                border-radius: 8px;
            }
        """)

# 第227-259行 (接续)
=======

        # 面板A左侧：图表区域（matplotlib）
        chart_widget = QWidget()
        chart_layout = QVBoxLayout(chart_widget)
        
        # 添加孔径监测图的说明信息
        chart_info_widget = QWidget()
        chart_info_layout = QHBoxLayout(chart_info_widget)
        chart_info_layout.setContentsMargins(10, 5, 10, 5)
        
        chart_info_label = QLabel("光谱共焦传感器孔径监测数据")
        chart_info_label.setStyleSheet("""
            QLabel {
                font-size: 14px;
                font-weight: bold;
                color: #2E7D32;
                background-color: #e8f5e8;
                padding: 8px 15px;
                border: 1px solid #4CAF50;
                border-radius: 6px;
            }
        """)
        
        chart_info_layout.addWidget(chart_info_label)
        chart_info_layout.addStretch()
        
        chart_layout.addWidget(chart_info_widget)

        # 创建matplotlib图形，优化尺寸以最大化显示区域
        self.figure = Figure(figsize=(24, 12), dpi=100)
        self.canvas = FigureCanvas(self.figure)
        chart_layout.addWidget(self.canvas)

        # 连接鼠标事件用于缩放和重置
        self.canvas.mpl_connect('scroll_event', self.on_scroll)
        self.canvas.mpl_connect('button_press_event', self.on_mouse_press)

        # 创建子图 - 增大字体
        self.ax = self.figure.add_subplot(111)
        self.ax.set_xlabel('探头深度 (mm)', fontsize=14, fontweight='bold')
        self.ax.set_ylabel('孔径直径 (mm)', fontsize=14, fontweight='bold')
        self.ax.set_title('实时孔径监测数据', fontsize=16, fontweight='bold', pad=20,
                         bbox=dict(boxstyle="round,pad=0.3", facecolor="#e8f5e8", edgecolor="#4CAF50"))
        self.ax.grid(True, alpha=0.3)
>>>>>>> origin/main
```

### **main分支版本**
```python
# 第203-259行
        # 双面板区域 - 改为垂直布局（A在上，B在下）
        splitter = QSplitter(Qt.Vertical)

        # 面板A: 管孔直径数据 - 无边框设计，最大化内容区域
        panel_a_widget = QWidget()
        panel_a_widget.setObjectName("PanelAWidget")
        panel_a_layout = QHBoxLayout(panel_a_widget)  # 水平布局：图表在左，异常窗口在右
        panel_a_layout.setContentsMargins(8, 8, 8, 8)  # 减少边距
        panel_a_layout.setSpacing(10)

        # 面板A左侧：图表区域（matplotlib）
        chart_widget = QWidget()
        chart_widget.setObjectName("ChartWidget")
        chart_layout = QVBoxLayout(chart_widget)
        chart_layout.setContentsMargins(0, 0, 0, 0)  # 移除边距，最大化图表区域

        # 创建图表标题栏
        chart_header = QWidget()
        chart_header.setObjectName("PanelHeader")
        chart_header_layout = QHBoxLayout(chart_header)
        chart_header_layout.setContentsMargins(15, 0, 15, 0)  # 左右留边距
        chart_header_layout.setSpacing(10)

        chart_title = QLabel("管孔直径实时监测")
        chart_title.setObjectName("PanelHeaderText")

        # 添加工具按钮
        from PySide6.QtWidgets import QToolButton
        export_chart_button = QToolButton()
        export_chart_button.setObjectName("HeaderToolButton")
        if HAS_QTAWESOME:
            export_chart_button.setText(qta.icon('fa5s.chart-bar').char)
        else:
            export_chart_button.setText("📊")  # 使用emoji作为图标
        export_chart_button.setToolTip("导出图表为图片")

        refresh_chart_button = QToolButton()
        refresh_chart_button.setObjectName("HeaderToolButton")
        if HAS_QTAWESOME:
            refresh_chart_button.setText(qta.icon('fa5s.sync-alt').char)
        else:
            refresh_chart_button.setText("🔄")  # 使用emoji作为图标
        refresh_chart_button.setToolTip("刷新图表")

        chart_header_layout.addWidget(chart_title)
        chart_header_layout.addStretch()
        chart_header_layout.addWidget(refresh_chart_button)
        chart_header_layout.addWidget(export_chart_button)

        # 将标题栏添加到布局
        chart_layout.addWidget(chart_header)

        # 创建matplotlib图形，优化尺寸以最大化显示区域
        self.figure = Figure(figsize=(24, 12), dpi=100)
        self.canvas = FigureCanvas(self.figure)
        chart_layout.addWidget(self.canvas)

        # 连接鼠标事件用于缩放和重置
        self.canvas.mpl_connect('scroll_event', self.on_scroll)
        self.canvas.mpl_connect('button_press_event', self.on_mouse_press)

        # 创建子图 - 增大字体
        self.ax = self.figure.add_subplot(111)
        self.apply_matplotlib_dark_theme()  # 应用深色主题
        self.ax.set_xlabel('深度 (mm)', fontsize=14, fontweight='bold')
        self.ax.set_ylabel('直径 (mm)', fontsize=14, fontweight='bold')
        # 移除matplotlib内部标题，使用外部标题栏
        # self.ax.set_title('管孔直径实时监测', fontsize=16, fontweight='bold', pad=15)
        self.ax.grid(True, alpha=0.3)
```

## 🔴 冲突区域3: 第272-283行 - matplotlib图表配置

### **wsy_2分支版本**
```python
# 第272-277行
        # 设置坐标轴刻度字体大小
        self.ax.tick_params(axis='both', which='major', labelsize=12)
        self.ax.tick_params(axis='both', which='minor', labelsize=10)

        # 设置初始范围
        self.ax.set_ylim(16.5, 20.5)

# 第277-283行 (接续)
=======
        self.ax.set_xlim(0, 950)

        # 初始化数据线
        self.data_line, = self.ax.plot([], [], 'b-', linewidth=3, label='直径数据')

        # 设置图形样式，确保所有标签都能完整显示
        self.figure.subplots_adjust(left=0.12, bottom=0.15, right=0.95, top=0.85)
>>>>>>> origin/main
```

### **main分支版本**
```python
# 第272-283行
        # 设置坐标轴刻度字体大小
        self.ax.tick_params(axis='both', which='major', labelsize=12)
        self.ax.tick_params(axis='both', which='minor', labelsize=10)

        # 设置初始范围
        self.ax.set_ylim(16.5, 20.5)
        self.ax.set_xlim(0, 950)

        # 初始化数据线 - 使用主题蓝色
        self.data_line, = self.ax.plot([], [], color='#4A90E2', linewidth=3, label='直径数据')

        # 设置图形样式，确保所有标签都能完整显示
        self.figure.subplots_adjust(left=0.12, bottom=0.15, right=0.95, top=0.85)
```

## 🔴 冲突区域4: 第338-391行 - 面板布局完成和初始化

### **wsy_2分支版本**
```python
# 第338-389行
        # 设置图例位置，确保不被遮挡 - 增大字体
        self.ax.legend(loc='upper right', bbox_to_anchor=(0.95, 0.95), fontsize=12)

        # 在图表下方添加面板A专用控制按钮（移除标准直径输入）
        self.create_panel_a_controls(chart_layout)

        panel_a_layout.addWidget(chart_widget)

        # 面板A右侧：异常数据显示区域和按钮
        right_panel = QWidget()
        right_panel.setMinimumWidth(320)  # 设置最小宽度而不是固定宽度
        right_panel.setMaximumWidth(400)  # 设置最大宽度，允许适度调整
        right_layout = QVBoxLayout(right_panel)
        right_layout.setContentsMargins(5, 5, 5, 5)  # 设置边距
        right_layout.setSpacing(8)  # 设置组件间距

        # 异常监控窗口 - 使用stretch factor占据大部分空间
        self.create_anomaly_panel(right_layout)

        # 添加固定间距，确保按钮不会紧贴异常面板
        right_layout.addSpacing(15)

        # 添加【查看下一个样品】按钮 - 使用Material Design绿色样式
        self.next_sample_button = QPushButton("查看下一个样品")
        self.next_sample_button.clicked.connect(self.view_next_sample)
        self.next_sample_button.setStyleSheet("""
            QPushButton {
                font-weight: bold;
                padding: 10px 16px;
                border: 2px solid #4CAF50;
                border-radius: 8px;
                background-color: #4CAF50;
                color: white;
                min-height: 40px;
            }
            QPushButton:hover {
                background-color: #45a049;
                border-color: #45a049;
            }
            QPushButton:pressed {
                background-color: #3d8b40;
            }
        """)
        from PySide6.QtWidgets import QSizePolicy
        self.next_sample_button.setSizePolicy(
            QSizePolicy.Expanding,
            QSizePolicy.Fixed
        )
        right_layout.addWidget(self.next_sample_button)

        # 添加底部间距，确保按钮不会贴底
        right_layout.addSpacing(10)

        panel_a_layout.addWidget(right_panel)
        splitter.addWidget(panel_a)

        # 面板B: 内窥镜图像 - 无边框设计，直接添加内窥镜视图
        panel_b = QGroupBox("内窥镜实时图像")
        panel_b.setStyleSheet("""
            QGroupBox {
                font-weight: bold;
                font-size: 16px;
                border: 3px solid #2196F3;
                border-radius: 12px;
                margin-top: 15px;
                padding-top: 15px;
                background-color: #f3f8ff;
            }
            QGroupBox::title {
                subcontrol-origin: margin;
                left: 20px;
                padding: 5px 15px 5px 15px;
                color: #1976D2;
                background-color: white;
                font-size: 16px;
                font-weight: bold;
                border: 2px solid #2196F3;
                border-radius: 8px;
            }
        """)
        panel_b_layout = QVBoxLayout(panel_b)

        # 添加内窥镜图像的说明信息
        endoscope_info_widget = QWidget()
        endoscope_info_layout = QHBoxLayout(endoscope_info_widget)
        endoscope_info_layout.setContentsMargins(10, 5, 10, 5)
        
        info_label = QLabel("BISDM内窥镜实时监测图像")
        info_label.setStyleSheet("""
            QLabel {
                font-size: 14px;
                font-weight: bold;
                color: #1976D2;
                background-color: #e3f2fd;
                padding: 8px 15px;
                border: 1px solid #2196F3;
                border-radius: 6px;
            }
        """)

# 第389-391行 (接续)
=======

        splitter.addWidget(panel_a_widget)
>>>>>>> origin/main
```

### **main分支版本**
```python
# 第338-391行
        # 设置图例位置，确保不被遮挡 - 增大字体
        self.ax.legend(loc='upper right', bbox_to_anchor=(0.95, 0.95), fontsize=12)

        # 在图表下方添加面板A专用控制按钮（移除标准直径输入）
        self.create_panel_a_controls(chart_layout)

        panel_a_layout.addWidget(chart_widget)

        # 面板A右侧：异常数据显示区域和按钮
        right_panel = QWidget()
        right_panel.setObjectName("RightPanel")
        right_panel.setMinimumWidth(320)  # 设置最小宽度而不是固定宽度
        right_panel.setMaximumWidth(400)  # 设置最大宽度，允许适度调整
        right_layout = QVBoxLayout(right_panel)
        right_layout.setContentsMargins(5, 5, 5, 5)  # 设置边距
        right_layout.setSpacing(8)  # 设置组件间距

        # 异常监控窗口 - 使用stretch factor占据大部分空间
        self.create_anomaly_panel(right_layout)

        # 添加固定间距，确保按钮不会紧贴异常面板
        right_layout.addSpacing(15)

        # 添加【查看下一个样品】按钮 - 使用主题样式
        self.next_sample_button = QPushButton("查看下一个样品")
        self.next_sample_button.clicked.connect(self.view_next_sample)
        self.next_sample_button.setObjectName("next_sample_button")
        from PySide6.QtWidgets import QSizePolicy
        self.next_sample_button.setSizePolicy(
            QSizePolicy.Expanding,
            QSizePolicy.Fixed
        )
        right_layout.addWidget(self.next_sample_button)

        # 添加底部间距，确保按钮不会贴底
        right_layout.addSpacing(10)

        panel_a_layout.addWidget(right_panel)
        splitter.addWidget(panel_a_widget)

        # 面板B: 内窥镜图像 - 无边框设计，直接添加内窥镜视图
        self.endoscope_view = EndoscopeView()
        self.endoscope_view.setObjectName("EndoscopeWidget")
        splitter.addWidget(self.endoscope_view)

        # 设置分割器比例，使用相对比例而不是固定像素
        # 面板A占65%，面板B占35%
        layout.addWidget(splitter)

        # 保存分割器引用，用于后续调整
        self.main_splitter = splitter

        # 延迟设置分割器比例，确保窗口已完全初始化
        from PySide6.QtCore import QTimer
        QTimer.singleShot(100, lambda: self.safe_adjust_splitter_sizes(splitter))

        # 初始化孔位数据映射
        self.init_hole_data_mapping()

        # 连接按钮信号（按钮已在状态栏中创建）
        self.start_button.clicked.connect(self.start_csv_data_import)
        self.stop_button.clicked.connect(self.stop_csv_data_import)
        self.clear_button.clicked.connect(self.clear_data)

        # 初始状态下禁用按钮，等待从主检测界面跳转
        self.start_button.setEnabled(False)
        self.stop_button.setEnabled(False)
        self.clear_button.setEnabled(False)

        # 设置按钮提示
        self.start_button.setToolTip("请先从主检测界面选择孔位")
        self.stop_button.setToolTip("请先从主检测界面选择孔位")
        self.clear_button.setToolTip("请先从主检测界面选择孔位")

        # 设置等待状态
        self.setup_waiting_state()
```

---

## 📊 **冲突分析总结**

### **核心差异点**

1. **🎨 设计风格完全不同**:
   - **wsy_2**: Material Design风格，绿色(`#4CAF50`)和蓝色(`#2196F3`)配色
   - **main**: 现代科技蓝主题，使用ObjectName + 主题管理器

2. **🏗️ 架构方式根本不同**:
   - **wsy_2**: 大量内联CSS样式，QGroupBox + 装饰性边框
   - **main**: ObjectName选择器 + 统一主题管理，无边框简洁设计

3. **🔧 功能实现差异**:
   - **wsy_2**: 双面板(A+B)设计，包含内窥镜面板
   - **main**: 简化的单一内容区 + 状态仪表盘集成

4. **🎯 按钮和控制元素**:
   - **wsy_2**: 控制按钮分散在不同位置，Material Design样式
   - **main**: 控制按钮集成在状态栏，使用emoji图标

5. **📈 matplotlib集成**:
   - **wsy_2**: 装饰性标题框，绿色主题
   - **main**: 深色主题，外部标题栏，蓝色数据线

### **解决建议**

这是两套完全不同的设计系统冲突，需要做出架构性决策：

1. **选择设计系统**: Material Design(wsy_2) vs 现代科技蓝(main)
2. **选择架构方式**: 内联样式 vs 主题管理器
3. **功能整合**: 决定保留哪些UI元素和功能特性
4. **测试验证**: 确保选择的方案在整个系统中保持一致

**建议**: 采用main分支的架构(主题管理器)，但可以考虑调整配色方案以保持项目整体风格一致。